{% extends "plotapp/base.html" %}
{% load formatters %}
{% block title %}Unit Commitment Optimization{% endblock %}

{% block content %}
<div class="card shadow p-4 mb-4">
  <h2 class="text-center mb-4">Result {{ run_id }}</h2>

  <!-- Forward Curve Plot -->
  <div class="text-center mb-4">
    <img src="data:image/png;base64,{{ image }}" alt="Forward Curve" class="img-fluid">
  </div>

  <!-- Financial Metrics -->
  <h3>Financial Metrics</h3>
  <div class="table-responsive">
    <table class="table table-striped">
      <tbody>
        <tr>
          <th>Total commitment</th>
          <td>{{ financials.total_commitment_hours }} h</td>
        </tr>
        <tr>
          <th>Relative uptime</th>
          <td>{{ financials.relative_uptime_percent|space_thousands }}%</td>
        </tr>
        <tr>
          <th>Total revenue</th>
          <td>BGN {{ financials.total_revenue|space_thousands }}</td>
        </tr>
        <tr>
          <th>Revenue per MWh</th>
          <td>BGN {{ financials.revenue_per_MWh|space_thousands }}</td>
        </tr>
        <tr>
          <th>Total profit</th>
          <td>BGN {{ financials.total_profit|space_thousands }}</td>
        </tr>
        <tr>
          <th>Profit per MWh</th>
          <td>BGN {{ financials.profit_per_MWh|space_thousands }}</td>
        </tr>
        <tr>
          <th>Total expenses</th>
          <td>BGN {{ financials.total_expenses|space_thousands }}</td>
        </tr>
        <tr>
          <th>Expenses per MWh</th>
          <td>BGN {{ financials.expenses_per_MWh|space_thousands }}</td>
        </tr>
        <tr>
          <th>Total coal and CO2 expenses</th>
          <td>BGN {{ financials.coal_co2_expenses|space_thousands }}</td>
        </tr>
        <tr>
          <th>Coal and CO2 expenses per MWh</th>
          <td>BGN {{ financials.coal_co2_per_MWh|space_thousands }}</td>
        </tr>
        <tr>
          <th>Total startups</th>
          <td>{{ financials.total_startups|space_thousands }}</td>
        </tr>
        <tr>
          <th>Startup cost total</th>
          <td>BGN {{ financials.startup_cost_total|space_thousands }}</td>
        </tr>
        <tr>
          <th>Startup cost per MWh</th>
          <td>BGN {{ financials.startup_cost_per_MWh|space_thousands }}</td>
        </tr>
      </tbody>
    </table>
  </div>
    
    <!-- Download Buttons -->
  <div class="text-center mb-4">
    {% if load_curve_csv_file %}
      <a class="btn btn-primary" href="{% url 'download_curve_csv' load_curve_csv_file %}">Download Load Curve CSV</a>
    {% endif %}
    {% if png_file %}
      <a class="btn btn-primary" href="{% url 'download_png' png_file %}">Download PNG</a>
    {% endif %}
    {% if results_csv_file %}
      <a class="btn btn-primary" href="{% url 'download_results_csv' results_csv_file %}">Download Results CSV</a>
    {% endif %}
  </div>

    <!-- Extract Period Form -->
  <div class="text-center mt-4">
      <form method="post" action="{% url 'extracted_result' run_id %}" class="text-center mb-4">
          {% csrf_token %}
          
          {% if extract_form.non_field_errors %}
              <div class="alert alert-danger">
                {% for error in extract_form.non_field_errors %}
                    {{ error }}<br>
                {% endfor %}
              </div>
          {% endif %}

          {% for field in extract_form %}
                <div class="mb-2">
                {{ field.label_tag }} {{ field }}
                {% if field.errors %}
                    <div class="alert alert-danger mt-1 p-2">
                        {% for error in field.errors %}
                            {{ error }}<br>
                        {% endfor %}
                    </div>
                {% endif %}
                
                </div>
          {% endfor %}
        
          <button type="submit" class="btn btn-secondary">Extract period</button>
      </form>
      <a href="/" type="submit" class="btn btn-secondary">Upload another file</a>
  </div>
</div>
{% endblock %}